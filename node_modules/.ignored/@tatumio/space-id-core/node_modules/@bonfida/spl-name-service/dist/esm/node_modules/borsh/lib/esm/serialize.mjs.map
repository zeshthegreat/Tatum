{"version":3,"file":"serialize.mjs","sources":["../../../../../../node_modules/borsh/lib/esm/serialize.js"],"sourcesContent":["import { integers } from './types.js';\nimport { EncodeBuffer } from './buffer.js';\nimport * as utils from './utils.js';\nvar BorshSerializer = /** @class */ (function () {\n    function BorshSerializer(checkTypes) {\n        this.encoded = new EncodeBuffer();\n        this.fieldPath = ['value'];\n        this.checkTypes = checkTypes;\n    }\n    BorshSerializer.prototype.encode = function (value, schema) {\n        this.encode_value(value, schema);\n        return this.encoded.get_used_buffer();\n    };\n    BorshSerializer.prototype.encode_value = function (value, schema) {\n        if (typeof schema === 'string') {\n            if (integers.includes(schema))\n                return this.encode_integer(value, schema);\n            if (schema === 'string')\n                return this.encode_string(value);\n            if (schema === 'bool')\n                return this.encode_boolean(value);\n        }\n        if (typeof schema === 'object') {\n            if ('option' in schema)\n                return this.encode_option(value, schema);\n            if ('enum' in schema)\n                return this.encode_enum(value, schema);\n            if ('array' in schema)\n                return this.encode_array(value, schema);\n            if ('set' in schema)\n                return this.encode_set(value, schema);\n            if ('map' in schema)\n                return this.encode_map(value, schema);\n            if ('struct' in schema)\n                return this.encode_struct(value, schema);\n        }\n    };\n    BorshSerializer.prototype.encode_integer = function (value, schema) {\n        var size = parseInt(schema.substring(1));\n        if (size <= 32 || schema == 'f64') {\n            this.checkTypes && utils.expect_type(value, 'number', this.fieldPath);\n            this.encoded.store_value(value, schema);\n        }\n        else {\n            this.checkTypes && utils.expect_bigint(value, this.fieldPath);\n            this.encode_bigint(BigInt(value), size);\n        }\n    };\n    BorshSerializer.prototype.encode_bigint = function (value, size) {\n        var buffer_len = size / 8;\n        var buffer = new Uint8Array(buffer_len);\n        for (var i = 0; i < buffer_len; i++) {\n            buffer[i] = Number(value & BigInt(0xff));\n            value = value >> BigInt(8);\n        }\n        this.encoded.store_bytes(new Uint8Array(buffer));\n    };\n    BorshSerializer.prototype.encode_string = function (value) {\n        this.checkTypes && utils.expect_type(value, 'string', this.fieldPath);\n        var _value = value;\n        // encode to utf8 bytes without using TextEncoder\n        var utf8Bytes = [];\n        for (var i = 0; i < _value.length; i++) {\n            var charCode = _value.charCodeAt(i);\n            if (charCode < 0x80) {\n                utf8Bytes.push(charCode);\n            }\n            else if (charCode < 0x800) {\n                utf8Bytes.push(0xc0 | (charCode >> 6), 0x80 | (charCode & 0x3f));\n            }\n            else if (charCode < 0xd800 || charCode >= 0xe000) {\n                utf8Bytes.push(0xe0 | (charCode >> 12), 0x80 | ((charCode >> 6) & 0x3f), 0x80 | (charCode & 0x3f));\n            }\n            else {\n                i++;\n                charCode = 0x10000 + (((charCode & 0x3ff) << 10) | (_value.charCodeAt(i) & 0x3ff));\n                utf8Bytes.push(0xf0 | (charCode >> 18), 0x80 | ((charCode >> 12) & 0x3f), 0x80 | ((charCode >> 6) & 0x3f), 0x80 | (charCode & 0x3f));\n            }\n        }\n        // 4 bytes for length + string bytes\n        this.encoded.store_value(utf8Bytes.length, 'u32');\n        this.encoded.store_bytes(new Uint8Array(utf8Bytes));\n    };\n    BorshSerializer.prototype.encode_boolean = function (value) {\n        this.checkTypes && utils.expect_type(value, 'boolean', this.fieldPath);\n        this.encoded.store_value(value ? 1 : 0, 'u8');\n    };\n    BorshSerializer.prototype.encode_option = function (value, schema) {\n        if (value === null || value === undefined) {\n            this.encoded.store_value(0, 'u8');\n        }\n        else {\n            this.encoded.store_value(1, 'u8');\n            this.encode_value(value, schema.option);\n        }\n    };\n    BorshSerializer.prototype.encode_enum = function (value, schema) {\n        this.checkTypes && utils.expect_enum(value, this.fieldPath);\n        var valueKey = Object.keys(value)[0];\n        for (var i = 0; i < schema[\"enum\"].length; i++) {\n            var valueSchema = schema[\"enum\"][i];\n            if (valueKey === Object.keys(valueSchema.struct)[0]) {\n                this.encoded.store_value(i, 'u8');\n                return this.encode_struct(value, valueSchema);\n            }\n        }\n        throw new Error(\"Enum key (\".concat(valueKey, \") not found in enum schema: \").concat(JSON.stringify(schema), \" at \").concat(this.fieldPath.join('.')));\n    };\n    BorshSerializer.prototype.encode_array = function (value, schema) {\n        if (utils.isArrayLike(value))\n            return this.encode_arraylike(value, schema);\n        if (value instanceof ArrayBuffer)\n            return this.encode_buffer(value, schema);\n        throw new Error(\"Expected Array-like not \".concat(typeof (value), \"(\").concat(value, \") at \").concat(this.fieldPath.join('.')));\n    };\n    BorshSerializer.prototype.encode_arraylike = function (value, schema) {\n        if (schema.array.len) {\n            utils.expect_same_size(value.length, schema.array.len, this.fieldPath);\n        }\n        else {\n            // 4 bytes for length\n            this.encoded.store_value(value.length, 'u32');\n        }\n        // array values\n        for (var i = 0; i < value.length; i++) {\n            this.encode_value(value[i], schema.array.type);\n        }\n    };\n    BorshSerializer.prototype.encode_buffer = function (value, schema) {\n        if (schema.array.len) {\n            utils.expect_same_size(value.byteLength, schema.array.len, this.fieldPath);\n        }\n        else {\n            // 4 bytes for length\n            this.encoded.store_value(value.byteLength, 'u32');\n        }\n        // array values\n        this.encoded.store_bytes(new Uint8Array(value));\n    };\n    BorshSerializer.prototype.encode_set = function (value, schema) {\n        this.checkTypes && utils.expect_type(value, 'object', this.fieldPath);\n        var isSet = value instanceof Set;\n        var values = isSet ? Array.from(value.values()) : Object.values(value);\n        // 4 bytes for length\n        this.encoded.store_value(values.length, 'u32');\n        // set values\n        for (var _i = 0, values_1 = values; _i < values_1.length; _i++) {\n            var value_1 = values_1[_i];\n            this.encode_value(value_1, schema.set);\n        }\n    };\n    BorshSerializer.prototype.encode_map = function (value, schema) {\n        this.checkTypes && utils.expect_type(value, 'object', this.fieldPath);\n        var isMap = value instanceof Map;\n        var keys = isMap ? Array.from(value.keys()) : Object.keys(value);\n        // 4 bytes for length\n        this.encoded.store_value(keys.length, 'u32');\n        // store key/values\n        for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {\n            var key = keys_1[_i];\n            this.encode_value(key, schema.map.key);\n            this.encode_value(isMap ? value.get(key) : value[key], schema.map.value);\n        }\n    };\n    BorshSerializer.prototype.encode_struct = function (value, schema) {\n        this.checkTypes && utils.expect_type(value, 'object', this.fieldPath);\n        for (var _i = 0, _a = Object.keys(schema.struct); _i < _a.length; _i++) {\n            var key = _a[_i];\n            this.fieldPath.push(key);\n            this.encode_value(value[key], schema.struct[key]);\n            this.fieldPath.pop();\n        }\n    };\n    return BorshSerializer;\n}());\nexport { BorshSerializer };\n"],"names":["BorshSerializer","checkTypes","this","encoded","EncodeBuffer","fieldPath","prototype","encode","value","schema","encode_value","get_used_buffer","integers","includes","encode_integer","encode_string","encode_boolean","encode_option","encode_enum","encode_array","encode_set","encode_map","encode_struct","size","parseInt","substring","utils","store_value","encode_bigint","BigInt","buffer_len","buffer","Uint8Array","i","Number","store_bytes","_value","utf8Bytes","length","charCode","charCodeAt","push","option","valueKey","Object","keys","valueSchema","struct","Error","concat","JSON","stringify","join","encode_arraylike","ArrayBuffer","encode_buffer","array","len","type","byteLength","values","Set","Array","from","_i","values_1","value_1","set","isMap","Map","keys_1","key","map","get","_a","pop"],"mappings":"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","x_google_ignoreList":[0]}
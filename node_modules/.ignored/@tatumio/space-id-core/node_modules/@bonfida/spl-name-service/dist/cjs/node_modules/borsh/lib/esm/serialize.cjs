"use strict";var e=require("./types.cjs"),t=require("./buffer.cjs"),n=require("./utils.cjs"),r=function(){function r(e){this.encoded=new t.EncodeBuffer,this.fieldPath=["value"],this.checkTypes=e}return r.prototype.encode=function(e,t){return this.encode_value(e,t),this.encoded.get_used_buffer()},r.prototype.encode_value=function(t,n){if("string"==typeof n){if(e.integers.includes(n))return this.encode_integer(t,n);if("string"===n)return this.encode_string(t);if("bool"===n)return this.encode_boolean(t)}if("object"==typeof n){if("option"in n)return this.encode_option(t,n);if("enum"in n)return this.encode_enum(t,n);if("array"in n)return this.encode_array(t,n);if("set"in n)return this.encode_set(t,n);if("map"in n)return this.encode_map(t,n);if("struct"in n)return this.encode_struct(t,n)}},r.prototype.encode_integer=function(e,t){var r=parseInt(t.substring(1));r<=32||"f64"==t?(this.checkTypes&&n.expect_type(e,"number",this.fieldPath),this.encoded.store_value(e,t)):(this.checkTypes&&n.expect_bigint(e,this.fieldPath),this.encode_bigint(BigInt(e),r))},r.prototype.encode_bigint=function(e,t){for(var n=t/8,r=new Uint8Array(n),o=0;o<n;o++)r[o]=Number(e&BigInt(255)),e>>=BigInt(8);this.encoded.store_bytes(new Uint8Array(r))},r.prototype.encode_string=function(e){this.checkTypes&&n.expect_type(e,"string",this.fieldPath);for(var t=e,r=[],o=0;o<t.length;o++){var i=t.charCodeAt(o);i<128?r.push(i):i<2048?r.push(192|i>>6,128|63&i):i<55296||i>=57344?r.push(224|i>>12,128|i>>6&63,128|63&i):(o++,i=65536+((1023&i)<<10|1023&t.charCodeAt(o)),r.push(240|i>>18,128|i>>12&63,128|i>>6&63,128|63&i))}this.encoded.store_value(r.length,"u32"),this.encoded.store_bytes(new Uint8Array(r))},r.prototype.encode_boolean=function(e){this.checkTypes&&n.expect_type(e,"boolean",this.fieldPath),this.encoded.store_value(e?1:0,"u8")},r.prototype.encode_option=function(e,t){null==e?this.encoded.store_value(0,"u8"):(this.encoded.store_value(1,"u8"),this.encode_value(e,t.option))},r.prototype.encode_enum=function(e,t){this.checkTypes&&n.expect_enum(e,this.fieldPath);for(var r=Object.keys(e)[0],o=0;o<t.enum.length;o++){var i=t.enum[o];if(r===Object.keys(i.struct)[0])return this.encoded.store_value(o,"u8"),this.encode_struct(e,i)}throw new Error("Enum key (".concat(r,") not found in enum schema: ").concat(JSON.stringify(t)," at ").concat(this.fieldPath.join(".")))},r.prototype.encode_array=function(e,t){if(n.isArrayLike(e))return this.encode_arraylike(e,t);if(e instanceof ArrayBuffer)return this.encode_buffer(e,t);throw new Error("Expected Array-like not ".concat(typeof e,"(").concat(e,") at ").concat(this.fieldPath.join(".")))},r.prototype.encode_arraylike=function(e,t){t.array.len?n.expect_same_size(e.length,t.array.len,this.fieldPath):this.encoded.store_value(e.length,"u32");for(var r=0;r<e.length;r++)this.encode_value(e[r],t.array.type)},r.prototype.encode_buffer=function(e,t){t.array.len?n.expect_same_size(e.byteLength,t.array.len,this.fieldPath):this.encoded.store_value(e.byteLength,"u32"),this.encoded.store_bytes(new Uint8Array(e))},r.prototype.encode_set=function(e,t){this.checkTypes&&n.expect_type(e,"object",this.fieldPath);var r=e instanceof Set?Array.from(e.values()):Object.values(e);this.encoded.store_value(r.length,"u32");for(var o=0,i=r;o<i.length;o++){var s=i[o];this.encode_value(s,t.set)}},r.prototype.encode_map=function(e,t){this.checkTypes&&n.expect_type(e,"object",this.fieldPath);var r=e instanceof Map,o=r?Array.from(e.keys()):Object.keys(e);this.encoded.store_value(o.length,"u32");for(var i=0,s=o;i<s.length;i++){var c=s[i];this.encode_value(c,t.map.key),this.encode_value(r?e.get(c):e[c],t.map.value)}},r.prototype.encode_struct=function(e,t){this.checkTypes&&n.expect_type(e,"object",this.fieldPath);for(var r=0,o=Object.keys(t.struct);r<o.length;r++){var i=o[r];this.fieldPath.push(i),this.encode_value(e[i],t.struct[i]),this.fieldPath.pop()}},r}();exports.BorshSerializer=r;
//# sourceMappingURL=serialize.cjs.map

import{PublicKey as o,SystemProgram as t,SYSVAR_RENT_PUBKEY as n}from"@solana/web3.js";import{createInstructionV3 as s}from"../instructions/createInstructionV3.mjs";import{ROOT_DOMAIN_ACCOUNT as e,CENTRAL_STATE as r,REGISTER_PROGRAM_ID as m,REFERRERS as i,PYTH_FEEDS as a,NAME_PROGRAM_ID as c,PYTH_MAPPING_ACC as d,USDC_MINT as l,VAULT_OWNER as u}from"../constants.mjs";import{getHashedNameSync as f}from"../utils/getHashedNameSync.mjs";import{getNameAccountKeySync as p}from"../utils/getNameAccountKeySync.mjs";import{InvalidDomainError as w,PythFeedNotFoundError as h}from"../error.mjs";import{getAssociatedTokenAddressSync as j}from"../node_modules/@solana/spl-token/lib/esm/state/mint.mjs";import{createAssociatedTokenAccountIdempotentInstruction as g}from"../node_modules/@solana/spl-token/lib/esm/instructions/associatedTokenAccount.mjs";import{TOKEN_PROGRAM_ID as y}from"../node_modules/@solana/spl-token/lib/esm/constants.mjs";const I=async(I,b,k,v,A,x=l,B)=>{if(b.includes(".")||b.trim().toLowerCase()!==b)throw new w("The domain name is malformed");const S=f(b),T=p(S,void 0,e),_=f(T.toBase58()),N=p(_,r),[P]=o.findProgramAddressSync([T.toBuffer()],m),q=i.findIndex((o=>null==B?void 0:B.equals(o)));let C;const H=[];if(-1!==q&&B){C=j(x,B,!0);const o=await I.getAccountInfo(C);if(!(null==o?void 0:o.data)){const o=g(v,C,B,x);H.push(o)}}const K=j(x,u,!0),L=a.get(x.toBase58());if(!L)throw new h("The Pyth account for the provided mint was not found");const O=new s({name:b,space:k,referrerIdxOpt:-1!=q?q:null}).getInstruction(m,c,e,T,N,t.programId,r,v,A,d,new o(L.product),new o(L.price),K,y,n,P,C);return H.push(O),H};export{I as registerDomainName};
//# sourceMappingURL=registerDomainName.mjs.map

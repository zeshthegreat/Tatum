import{integers as e}from"./types.mjs";import{DecodeBuffer as t}from"./buffer.mjs";var r=function(){function r(e){this.buffer=new t(e)}return r.prototype.decode=function(e){return this.decode_value(e)},r.prototype.decode_value=function(t){if("string"==typeof t){if(e.includes(t))return this.decode_integer(t);if("string"===t)return this.decode_string();if("bool"===t)return this.decode_boolean()}if("object"==typeof t){if("option"in t)return this.decode_option(t);if("enum"in t)return this.decode_enum(t);if("array"in t)return this.decode_array(t);if("set"in t)return this.decode_set(t);if("map"in t)return this.decode_map(t);if("struct"in t)return this.decode_struct(t)}throw new Error("Unsupported type: ".concat(t))},r.prototype.decode_integer=function(e){var t=parseInt(e.substring(1));return t<=32||"f64"==e?this.buffer.consume_value(e):this.decode_bigint(t,e.startsWith("i"))},r.prototype.decode_bigint=function(e,t){void 0===t&&(t=!1);var r=e/8,o=new Uint8Array(this.buffer.consume_bytes(r)),n=o.reduceRight((function(e,t){return e+t.toString(16).padStart(2,"0")}),"");return t&&o[r-1]?BigInt.asIntN(e,BigInt("0x".concat(n))):BigInt("0x".concat(n))},r.prototype.decode_string=function(){for(var e=this.decode_integer("u32"),t=new Uint8Array(this.buffer.consume_bytes(e)),r=[],o=0;o<e;++o){var n=t[o];if(n<128)r.push(n);else if(n<224)r.push((31&n)<<6|63&t[++o]);else if(n<240)r.push((15&n)<<12|(63&t[++o])<<6|63&t[++o]);else{var i=(7&n)<<18|(63&t[++o])<<12|(63&t[++o])<<6|63&t[++o];r.push(i)}}return String.fromCodePoint.apply(String,r)},r.prototype.decode_boolean=function(){return this.buffer.consume_value("u8")>0},r.prototype.decode_option=function(e){var t=this.buffer.consume_value("u8");if(1===t)return this.decode_value(e.option);if(0!==t)throw new Error("Invalid option ".concat(t));return null},r.prototype.decode_enum=function(e){var t,r=this.buffer.consume_value("u8");if(r>e.enum.length)throw new Error("Enum option ".concat(r," is not available"));var o=e.enum[r].struct,n=Object.keys(o)[0];return(t={})[n]=this.decode_value(o[n]),t},r.prototype.decode_array=function(e){for(var t=[],r=e.array.len?e.array.len:this.decode_integer("u32"),o=0;o<r;++o)t.push(this.decode_value(e.array.type));return t},r.prototype.decode_set=function(e){for(var t=this.decode_integer("u32"),r=new Set,o=0;o<t;++o)r.add(this.decode_value(e.set));return r},r.prototype.decode_map=function(e){for(var t=this.decode_integer("u32"),r=new Map,o=0;o<t;++o){var n=this.decode_value(e.map.key),i=this.decode_value(e.map.value);r.set(n,i)}return r},r.prototype.decode_struct=function(e){var t={};for(var r in e.struct)t[r]=this.decode_value(e.struct[r]);return t},r}();export{r as BorshDeserializer};
//# sourceMappingURL=deserialize.mjs.map

"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,t=require("@solana/web3.js"),r=["u8","u16","u32","u64","u128","i8","i16","i32","i64","i128","f32","f64"],i=function(){function e(){this.offset=0,this.buffer_size=256,this.buffer=new ArrayBuffer(this.buffer_size),this.view=new DataView(this.buffer)}return e.prototype.resize_if_necessary=function(e){if(this.buffer_size-this.offset<e){this.buffer_size=Math.max(2*this.buffer_size,this.buffer_size+e);var t=new ArrayBuffer(this.buffer_size);new Uint8Array(t).set(new Uint8Array(this.buffer)),this.buffer=t,this.view=new DataView(t)}},e.prototype.get_used_buffer=function(){return new Uint8Array(this.buffer).slice(0,this.offset)},e.prototype.store_value=function(e,t){var r=t.substring(1),i=parseInt(r)/8;this.resize_if_necessary(i);var n="f"===t[0]?"setFloat".concat(r):"i"===t[0]?"setInt".concat(r):"setUint".concat(r);this.view[n](this.offset,e,!0),this.offset+=i},e.prototype.store_bytes=function(e){this.resize_if_necessary(e.length),new Uint8Array(this.buffer).set(new Uint8Array(e),this.offset),this.offset+=e.length},e}(),n=function(){function e(e){this.offset=0,this.buffer_size=e.length,this.buffer=new ArrayBuffer(e.length),new Uint8Array(this.buffer).set(e),this.view=new DataView(this.buffer)}return e.prototype.assert_enough_buffer=function(e){if(this.offset+e>this.buffer.byteLength)throw new Error("Error in schema, the buffer is smaller than expected")},e.prototype.consume_value=function(e){var t=e.substring(1),r=parseInt(t)/8;this.assert_enough_buffer(r);var i="f"===e[0]?"getFloat".concat(t):"i"===e[0]?"getInt".concat(t):"getUint".concat(t),n=this.view[i](this.offset,!0);return this.offset+=r,n},e.prototype.consume_bytes=function(e){this.assert_enough_buffer(e);var t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t},e}(),s=(e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)},function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)});function o(e,t,r){if(typeof e!==t)throw new Error("Expected ".concat(t," not ").concat(typeof e,"(").concat(e,") at ").concat(r.join(".")))}function a(e,t,r){if(e!==t)throw new Error("Array length ".concat(e," does not match schema length ").concat(t," at ").concat(r.join(".")))}var u=r.concat(["bool","string"]),c=["option","enum","array","set","map","struct"],h=function(e){function t(t,r){var i="Invalid schema: ".concat(JSON.stringify(t)," expected ").concat(r);return e.call(this,i)||this}return s(t,e),t}(Error);function f(e){if("string"!=typeof e||!u.includes(e)){if(e&&"object"==typeof e){var t=Object.keys(e);if(1===t.length&&c.includes(t[0])){var r=t[0];if("option"===r)return f(e[r]);if("enum"===r)return function(e){if(!Array.isArray(e))throw new h(e,"Array");for(var t=0,r=e;t<r.length;t++){var i=r[t];if("object"!=typeof i||!("struct"in i))throw new Error('Missing "struct" key in enum schema');if("object"!=typeof i.struct||1!==Object.keys(i.struct).length)throw new Error('The "struct" in each enum must have a single key');f({struct:i.struct})}}(e[r]);if("array"===r)return function(e){if("object"!=typeof e)throw new h(e,"{ type, len? }");if(e.len&&"number"!=typeof e.len)throw new Error("Invalid schema: ".concat(e));if("type"in e)return f(e.type);throw new h(e,"{ type, len? }")}(e[r]);if("set"===r)return f(e[r]);if("map"===r)return function(e){if("object"!=typeof e||!("key"in e)||!("value"in e))throw new h(e,"{ key, value }");f(e.key),f(e.value)}(e[r]);if("struct"===r)return function(e){if("object"!=typeof e)throw new h(e,"object");for(var t in e)f(e[t])}(e[r])}}throw new h(e,c.join(", ")+" or "+u.join(", "))}}var p=function(){function e(e){this.encoded=new i,this.fieldPath=["value"],this.checkTypes=e}return e.prototype.encode=function(e,t){return this.encode_value(e,t),this.encoded.get_used_buffer()},e.prototype.encode_value=function(e,t){if("string"==typeof t){if(r.includes(t))return this.encode_integer(e,t);if("string"===t)return this.encode_string(e);if("bool"===t)return this.encode_boolean(e)}if("object"==typeof t){if("option"in t)return this.encode_option(e,t);if("enum"in t)return this.encode_enum(e,t);if("array"in t)return this.encode_array(e,t);if("set"in t)return this.encode_set(e,t);if("map"in t)return this.encode_map(e,t);if("struct"in t)return this.encode_struct(e,t)}},e.prototype.encode_integer=function(e,t){var r=parseInt(t.substring(1));r<=32||"f64"==t?(this.checkTypes&&o(e,"number",this.fieldPath),this.encoded.store_value(e,t)):(this.checkTypes&&function(e,t){if(!(["number","string","bigint","boolean"].includes(typeof e)||"object"==typeof e&&null!==e&&"toString"in e))throw new Error("Expected bigint, number, boolean or string not ".concat(typeof e,"(").concat(e,") at ").concat(t.join(".")))}(e,this.fieldPath),this.encode_bigint(BigInt(e),r))},e.prototype.encode_bigint=function(e,t){for(var r=t/8,i=new Uint8Array(r),n=0;n<r;n++)i[n]=Number(e&BigInt(255)),e>>=BigInt(8);this.encoded.store_bytes(new Uint8Array(i))},e.prototype.encode_string=function(e){this.checkTypes&&o(e,"string",this.fieldPath);var t=e;this.encoded.store_value(t.length,"u32");for(var r=0;r<t.length;r++)this.encoded.store_value(t.charCodeAt(r),"u8")},e.prototype.encode_boolean=function(e){this.checkTypes&&o(e,"boolean",this.fieldPath),this.encoded.store_value(e?1:0,"u8")},e.prototype.encode_option=function(e,t){null==e?this.encoded.store_value(0,"u8"):(this.encoded.store_value(1,"u8"),this.encode_value(e,t.option))},e.prototype.encode_enum=function(e,t){this.checkTypes&&function(e,t){if("object"!=typeof e||null===e)throw new Error("Expected object not ".concat(typeof e,"(").concat(e,") at ").concat(t.join(".")))}(e,this.fieldPath);for(var r=Object.keys(e)[0],i=0;i<t.enum.length;i++){var n=t.enum[i];if(r===Object.keys(n.struct)[0])return this.encoded.store_value(i,"u8"),this.encode_struct(e,n)}throw new Error("Enum key (".concat(r,") not found in enum schema: ").concat(JSON.stringify(t)," at ").concat(this.fieldPath.join(".")))},e.prototype.encode_array=function(e,t){if(function(e){return Array.isArray(e)||!!e&&"object"==typeof e&&"length"in e&&"number"==typeof e.length&&(0===e.length||e.length>0&&e.length-1 in e)}(e))return this.encode_arraylike(e,t);if(e instanceof ArrayBuffer)return this.encode_buffer(e,t);throw new Error("Expected Array-like not ".concat(typeof e,"(").concat(e,") at ").concat(this.fieldPath.join(".")))},e.prototype.encode_arraylike=function(e,t){t.array.len?a(e.length,t.array.len,this.fieldPath):this.encoded.store_value(e.length,"u32");for(var r=0;r<e.length;r++)this.encode_value(e[r],t.array.type)},e.prototype.encode_buffer=function(e,t){t.array.len?a(e.byteLength,t.array.len,this.fieldPath):this.encoded.store_value(e.byteLength,"u32"),this.encoded.store_bytes(new Uint8Array(e))},e.prototype.encode_set=function(e,t){this.checkTypes&&o(e,"object",this.fieldPath);var r=e instanceof Set?Array.from(e.values()):Object.values(e);this.encoded.store_value(r.length,"u32");for(var i=0,n=r;i<n.length;i++){var s=n[i];this.encode_value(s,t.set)}},e.prototype.encode_map=function(e,t){this.checkTypes&&o(e,"object",this.fieldPath);var r=e instanceof Map,i=r?Array.from(e.keys()):Object.keys(e);this.encoded.store_value(i.length,"u32");for(var n=0,s=i;n<s.length;n++){var a=s[n];this.encode_value(a,t.map.key),this.encode_value(r?e.get(a):e[a],t.map.value)}},e.prototype.encode_struct=function(e,t){this.checkTypes&&o(e,"object",this.fieldPath);for(var r=0,i=Object.keys(t.struct);r<i.length;r++){var n=i[r];this.fieldPath.push(n),this.encode_value(e[n],t.struct[n]),this.fieldPath.pop()}},e}(),l=function(){function e(e){this.buffer=new n(e)}return e.prototype.decode=function(e){return this.decode_value(e)},e.prototype.decode_value=function(e){if("string"==typeof e){if(r.includes(e))return this.decode_integer(e);if("string"===e)return this.decode_string();if("bool"===e)return this.decode_boolean()}if("object"==typeof e){if("option"in e)return this.decode_option(e);if("enum"in e)return this.decode_enum(e);if("array"in e)return this.decode_array(e);if("set"in e)return this.decode_set(e);if("map"in e)return this.decode_map(e);if("struct"in e)return this.decode_struct(e)}throw new Error("Unsupported type: ".concat(e))},e.prototype.decode_integer=function(e){var t=parseInt(e.substring(1));return t<=32||"f64"==e?this.buffer.consume_value(e):this.decode_bigint(t,e.startsWith("i"))},e.prototype.decode_bigint=function(e,t){void 0===t&&(t=!1);var r=e/8,i=new Uint8Array(this.buffer.consume_bytes(r)),n=i.reduceRight((function(e,t){return e+t.toString(16).padStart(2,"0")}),"");return t&&i[r-1]?BigInt.asIntN(e,BigInt("0x".concat(n))):BigInt("0x".concat(n))},e.prototype.decode_string=function(){var e=this.decode_integer("u32"),t=new Uint8Array(this.buffer.consume_bytes(e));return String.fromCharCode.apply(null,t)},e.prototype.decode_boolean=function(){return this.buffer.consume_value("u8")>0},e.prototype.decode_option=function(e){var t=this.buffer.consume_value("u8");if(1===t)return this.decode_value(e.option);if(0!==t)throw new Error("Invalid option ".concat(t));return null},e.prototype.decode_enum=function(e){var t,r=this.buffer.consume_value("u8");if(r>e.enum.length)throw new Error("Enum option ".concat(r," is not available"));var i=e.enum[r].struct,n=Object.keys(i)[0];return(t={})[n]=this.decode_value(i[n]),t},e.prototype.decode_array=function(e){for(var t=[],r=e.array.len?e.array.len:this.decode_integer("u32"),i=0;i<r;++i)t.push(this.decode_value(e.array.type));return t},e.prototype.decode_set=function(e){for(var t=this.decode_integer("u32"),r=new Set,i=0;i<t;++i)r.add(this.decode_value(e.set));return r},e.prototype.decode_map=function(e){for(var t=this.decode_integer("u32"),r=new Map,i=0;i<t;++i){var n=this.decode_value(e.map.key),s=this.decode_value(e.map.value);r.set(n,s)}return r},e.prototype.decode_struct=function(e){var t={};for(var r in e.struct)t[r]=this.decode_value(e.struct[r]);return t},e}();function d(e,t,r){return void 0===r&&(r=!0),r&&f(e),new p(r).encode(t,e)}class y{constructor(e){this.tag=1,this.record=e.record,this.content=e.content}serialize(){return d(y.schema,this)}getInstruction(e,r,i,n,s,o,a,u){const c=Buffer.from(this.serialize());let h=[];return h.push({pubkey:r,isSigner:!1,isWritable:!1}),h.push({pubkey:i,isSigner:!1,isWritable:!1}),h.push({pubkey:n,isSigner:!0,isWritable:!0}),h.push({pubkey:s,isSigner:!1,isWritable:!0}),h.push({pubkey:o,isSigner:!1,isWritable:!0}),h.push({pubkey:a,isSigner:!0,isWritable:!0}),h.push({pubkey:u,isSigner:!1,isWritable:!1}),new t.TransactionInstruction({keys:h,programId:e,data:c})}}y.schema={struct:{tag:"u8",record:"string",content:{array:{type:"u8"}}}};class g{constructor(e){this.tag=4,this.validation=e.validation,this.signature=e.signature,this.expectedPubkey=e.expectedPubkey}serialize(){return d(g.schema,this)}getInstruction(e,r,i,n,s,o,a,u){const c=Buffer.from(this.serialize());let h=[];return h.push({pubkey:r,isSigner:!1,isWritable:!1}),h.push({pubkey:i,isSigner:!1,isWritable:!1}),h.push({pubkey:n,isSigner:!0,isWritable:!0}),h.push({pubkey:s,isSigner:!1,isWritable:!0}),h.push({pubkey:o,isSigner:!1,isWritable:!0}),h.push({pubkey:a,isSigner:!0,isWritable:!0}),h.push({pubkey:u,isSigner:!1,isWritable:!1}),new t.TransactionInstruction({keys:h,programId:e,data:c})}}g.schema={struct:{tag:"u8",validation:"u8",signature:{array:{type:"u8"}},expectedPubkey:{array:{type:"u8"}}}};class b{constructor(e){this.tag=0,this.contentLength=e.contentLength,this.record=e.record}serialize(){return d(b.schema,this)}getInstruction(e,r,i,n,s,o,a,u){const c=Buffer.from(this.serialize());let h=[];return h.push({pubkey:r,isSigner:!1,isWritable:!1}),h.push({pubkey:i,isSigner:!1,isWritable:!1}),h.push({pubkey:n,isSigner:!0,isWritable:!0}),h.push({pubkey:s,isSigner:!1,isWritable:!0}),h.push({pubkey:o,isSigner:!1,isWritable:!0}),h.push({pubkey:a,isSigner:!0,isWritable:!0}),h.push({pubkey:u,isSigner:!1,isWritable:!1}),new t.TransactionInstruction({keys:h,programId:e,data:c})}}b.schema={struct:{tag:"u8",contentLength:"u32",record:"string"}};class _{constructor(e){this.tag=3,this.staleness=e.staleness}serialize(){return d(_.schema,this)}getInstruction(e,r,i,n,s,o,a,u,c){const h=Buffer.from(this.serialize());let f=[];return f.push({pubkey:r,isSigner:!1,isWritable:!1}),f.push({pubkey:i,isSigner:!1,isWritable:!1}),f.push({pubkey:n,isSigner:!0,isWritable:!0}),f.push({pubkey:s,isSigner:!1,isWritable:!0}),f.push({pubkey:o,isSigner:!1,isWritable:!0}),f.push({pubkey:a,isSigner:!1,isWritable:!0}),f.push({pubkey:u,isSigner:!1,isWritable:!1}),f.push({pubkey:c,isSigner:!0,isWritable:!0}),new t.TransactionInstruction({keys:f,programId:e,data:h})}}_.schema={struct:{tag:"u8",staleness:"bool"}};class m{constructor(e){this.tag=2,this.record=e.record,this.content=e.content}serialize(){return d(m.schema,this)}getInstruction(e,r,i,n,s,o,a,u){const c=Buffer.from(this.serialize());let h=[];return h.push({pubkey:r,isSigner:!1,isWritable:!1}),h.push({pubkey:i,isSigner:!1,isWritable:!1}),h.push({pubkey:n,isSigner:!0,isWritable:!0}),h.push({pubkey:s,isSigner:!1,isWritable:!0}),h.push({pubkey:o,isSigner:!1,isWritable:!0}),h.push({pubkey:a,isSigner:!0,isWritable:!0}),h.push({pubkey:u,isSigner:!1,isWritable:!1}),new t.TransactionInstruction({keys:h,programId:e,data:c})}}m.schema={struct:{tag:"u8",record:"string",content:{array:{type:"u8"}}}};class v{constructor(){this.tag=5}serialize(){return d(v.schema,this)}getInstruction(e,r,i,n,s,o,a,u){const c=Buffer.from(this.serialize());let h=[];return h.push({pubkey:r,isSigner:!1,isWritable:!1}),h.push({pubkey:i,isSigner:!1,isWritable:!1}),h.push({pubkey:n,isSigner:!0,isWritable:!0}),h.push({pubkey:s,isSigner:!1,isWritable:!0}),h.push({pubkey:o,isSigner:!1,isWritable:!0}),h.push({pubkey:a,isSigner:!0,isWritable:!0}),h.push({pubkey:u,isSigner:!1,isWritable:!1}),new t.TransactionInstruction({keys:h,programId:e,data:c})}}v.schema={struct:{tag:"u8"}};class w{constructor(e){this.tag=6,this.roaId=e.roaId}serialize(){return d(w.schema,this)}getInstruction(e,r,i,n,s,o,a,u){const c=Buffer.from(this.serialize());let h=[];return h.push({pubkey:r,isSigner:!1,isWritable:!1}),h.push({pubkey:i,isSigner:!1,isWritable:!1}),h.push({pubkey:n,isSigner:!0,isWritable:!0}),h.push({pubkey:s,isSigner:!1,isWritable:!0}),h.push({pubkey:o,isSigner:!1,isWritable:!0}),h.push({pubkey:a,isSigner:!0,isWritable:!0}),h.push({pubkey:u,isSigner:!1,isWritable:!1}),new t.TransactionInstruction({keys:h,programId:e,data:c})}}w.schema={struct:{tag:"u8",roaId:{array:{type:"u8"}}}};class k{constructor(){this.tag=7}serialize(){return d(k.schema,this)}getInstruction(e,r,i,n,s,o,a,u){const c=Buffer.from(this.serialize());let h=[];return h.push({pubkey:r,isSigner:!1,isWritable:!1}),h.push({pubkey:i,isSigner:!1,isWritable:!1}),h.push({pubkey:n,isSigner:!0,isWritable:!0}),h.push({pubkey:s,isSigner:!1,isWritable:!0}),h.push({pubkey:o,isSigner:!1,isWritable:!0}),h.push({pubkey:a,isSigner:!1,isWritable:!1}),h.push({pubkey:u,isSigner:!0,isWritable:!0}),new t.TransactionInstruction({keys:h,programId:e,data:c})}}k.schema={struct:{tag:"u8"}};const S=new t.PublicKey("HP3D4D1ZCmohQGFVms2SS4LCANgJyksBf5s1F77FuFjZ"),[I]=t.PublicKey.findProgramAddressSync([S.toBuffer()],S);var W;exports.Validation=void 0,(W=exports.Validation||(exports.Validation={}))[W.None=0]="None",W[W.Solana=1]="Solana",W[W.Ethereum=2]="Ethereum",W[W.UnverifiedSolana=3]="UnverifiedSolana";const A=e=>{switch(e){case exports.Validation.None:return 0;case exports.Validation.Ethereum:return 20;case exports.Validation.Solana:case exports.Validation.UnverifiedSolana:return 32;default:throw new Error("Invalid validation enum")}};class x{constructor(e){this.stalenessValidation=e.stalenessValidation,this.rightOfAssociationValidation=e.rightOfAssociationValidation,this.contentLength=e.contentLength}static deserialize(e){return new x((t=this.schema,r=e,void 0===(i=!0)&&(i=!0),i&&f(t),new l(r).decode(t)));var t,r,i}static async retrieve(e,t){const r=await e.getAccountInfo(t);if(!r||!r.data)throw new Error("Record header account not found");return this.deserialize(r.data.slice(96,96+this.LEN))}}x.LEN=8,x.schema={struct:{stalenessValidation:"u16",rightOfAssociationValidation:"u16",contentLength:"u32"}};class E{constructor(e,t){this.data=t,this.header=e}static deserialize(e){const t=x.deserialize(e.slice(96,96+x.LEN)),r=e.slice(96+x.LEN);return new E(t,r)}static async retrieve(e,t){const r=await e.getAccountInfo(t);if(!r||!r.data)throw new Error("Record header account not found");return this.deserialize(r.data)}static async retrieveBatch(e,t){return(await e.getMultipleAccountsInfo(t)).map((e=>{if(null==e?void 0:e.data)return this.deserialize(e.data)}))}getContent(){let e=A(this.header.stalenessValidation)+A(this.header.rightOfAssociationValidation);return this.data.slice(e)}getStalenessId(){let e=A(this.header.stalenessValidation);return this.data.slice(0,e)}getRoAId(){let e=A(this.header.stalenessValidation),t=e+A(this.header.rightOfAssociationValidation);return this.data.slice(e,t)}}exports.CENTRAL_STATE_SNS_RECORDS=I,exports.NAME_REGISTRY_LEN=96,exports.Record=E,exports.RecordHeader=x,exports.SNS_RECORDS_ID=S,exports.allocateAndPostRecord=(e,r,i,n,s,o,a,u)=>new y({record:o,content:Array.from(a)}).getInstruction(u,t.SystemProgram.programId,s,e,r,i,n,I),exports.allocateAndPostRecordInstruction=y,exports.allocateRecord=(e,r,i,n,s,o,a,u)=>new b({contentLength:a,record:o}).getInstruction(u,t.SystemProgram.programId,s,e,r,i,n,I),exports.allocateRecordInstruction=b,exports.deleteRecord=(e,r,i,n,s,o)=>(new v).getInstruction(o,t.SystemProgram.programId,s,e,n,r,i,I),exports.deleteRecordInstruction=v,exports.editRecord=(e,r,i,n,s,o,a,u)=>new m({record:o,content:Array.from(a)}).getInstruction(u,t.SystemProgram.programId,s,e,r,i,n,I),exports.editRecordInstruction=m,exports.getValidationLength=A,exports.unverifyRoa=(e,r,i,n,s,o)=>(new k).getInstruction(o,t.SystemProgram.programId,r,e,i,n,I,s),exports.unverifyRoaInstruction=k,exports.validateEthSignature=(e,r,i,n,s,o,a,u,c)=>new g({validation:o,signature:Array.from(a),expectedPubkey:Array.from(u)}).getInstruction(c,t.SystemProgram.programId,s,e,r,i,n,I),exports.validateEthereumSignatureInstruction=g,exports.validateSolanaSignature=(e,r,i,n,s,o,a,u)=>new _({staleness:a}).getInstruction(u,t.SystemProgram.programId,o,e,r,i,n,I,s),exports.validateSolanaSignatureInstruction=_,exports.writeRoa=(e,r,i,n,s,o,a)=>new w({roaId:Array.from(o.toBuffer())}).getInstruction(a,t.SystemProgram.programId,r,e,i,n,s,I),exports.writeRoaInstruction=w;
//# sourceMappingURL=index.cjs.map
